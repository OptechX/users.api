name: crontab

on:
  workflow_dispatch:
  schedule:
    - cron: '30 5 * * 1,3,5'
    - cron: '30 5 * * 0,2,4,6'

jobs:
  dotnet-build:
    runs-on: ubuntu-latest
    steps:
      - name: 🛒 Checkout
        uses: actions/checkout@v3

      - name: 🗑️ Clean up gh-actions
        run: |
          user=optechx
          repo=users.api
          gh api repos/$user/$repo/actions/runs \
          --paginate -q '.workflow_runs[] | select(.head_branch != "master") | "\(.id)"' | \
          xargs -n1 -I % gh api --silent repos/$user/$repo/actions/runs/% -X DELETE
        env:
          GITHUB_TOKEN: ${{ secrets.PAT }}
